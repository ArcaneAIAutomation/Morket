<p align="center">
  <h1 align="center">ðŸš€ Morket</h1>
  <p align="center"><strong>Your prospects are out there. Morket finds them.</strong></p>
  <p align="center">The all-in-one data engine for sales and marketing teams who want better leads, faster.</p>
</p>

---

## What Is Morket?

Morket is a **lead enrichment and data automation platform** that turns incomplete prospect lists into fully loaded, sales-ready databases â€” automatically.

Think of it this way: you have a spreadsheet with 5,000 company names. That's it. No emails, no phone numbers, no job titles, no LinkedIn profiles. Morket takes that list and fills in the blanks in minutes, pulling data from multiple sources simultaneously so your team can stop researching and start selling.

**Morket is like hiring a team of research assistants who work 24/7, never make typos, and can look up thousands of contacts in the time it takes you to grab a coffee.** â˜•

---

## âœ¨ Features at a Glance

| What You Get | What It Means for You |
|---|---|
| ðŸ” **Data Enrichment** | Automatically find emails, phone numbers, job titles, and more |
| ðŸŒ **Web Scraping** | Pull data from websites without lifting a finger |
| ðŸ“Š **Spreadsheet Interface** | Work in a familiar Excel-like view â€” no learning curve |
| ðŸ”— **Multi-Provider Support** | Get data from Apollo, Clearbit, Hunter, and LinkedIn all at once |
| âš™ï¸ **Workflow Automation** | Build pipelines that run on autopilot |
| ðŸ¤ **CRM Integrations** | Sync directly with Salesforce and HubSpot |
| ðŸ‘¥ **Team Collaboration** | Shared workspaces with roles and activity tracking |
| ðŸ“ˆ **Analytics Dashboard** | See what's working and where your budget goes |
| ðŸ”Ž **Instant Search** | Find any record across your entire database in seconds |
| ðŸ§  **AI Intelligence** | Smart suggestions, duplicate detection, and quality scoring |
| ðŸ”’ **Enterprise Security** | Bank-grade encryption and access controls |
| ðŸ’³ **Pay-As-You-Go Billing** | Only pay for the data you actually use |

---

## ðŸŽ¯ Features In Depth

### ðŸ” Data Enrichment â€” Fill in the Blanks Automatically

**The problem:** You have a list of leads, but half the fields are empty. Manually looking up each contact takes hours.

**What Morket does:** You upload your list, pick the fields you need (email, phone, job title, company size, LinkedIn URL), and Morket fills them in automatically using multiple data providers at once.

**Example:** *Imagine you have 2,000 company names from a trade show. You paste them into Morket, hit "Enrich," and 10 minutes later you have verified email addresses, direct phone numbers, and job titles for the decision-makers at each company. Your SDR team can start outreach the same afternoon.*

**How it works behind the scenes:** Morket tries your first-choice data provider. If it doesn't have the answer, it automatically falls back to the next one â€” like a waterfall. You only pay for successful lookups.

---

### ðŸŒ Web Scraping â€” Pull Data from Any Website

**The problem:** Some of the best prospect data lives on websites, LinkedIn profiles, and job boards â€” but copying it by hand is tedious and error-prone.

**What Morket does:** Point Morket at a list of URLs and it extracts structured data automatically. LinkedIn profiles, company websites, job postings â€” it reads the page and pulls out the fields you care about.

**Example:** *Your marketing team wants to build a list of companies hiring for "Head of Growth." Morket scrapes job boards, extracts company names, locations, and posting details, and delivers a clean spreadsheet ready for outreach.*

---

### ðŸ“Š Spreadsheet Interface â€” Feels Like Excel, Works Like Magic

**The problem:** Most data tools force you to learn a new interface. Your team already knows spreadsheets.

**What Morket does:** Everything happens inside a familiar spreadsheet view. Sort, filter, edit, undo â€” it all works the way you'd expect. But unlike Excel, this spreadsheet is connected to live data enrichment, auto-saves your work, and handles 100,000+ rows without breaking a sweat.

**Key features:**
- âœï¸ Edit cells directly, with undo (up to 50 steps) and auto-save every 30 seconds
- ðŸ“¥ Import CSV files with a column mapping wizard
- ðŸ“¤ Export to CSV â€” all rows or just your selection
- ðŸ–±ï¸ Right-click context menus for quick actions (enrich, delete, export)
- âŒ¨ï¸ Keyboard shortcuts (Ctrl+Z to undo, just like you'd expect)

---

### ðŸ”— Multi-Provider Support â€” Don't Put All Your Eggs in One Basket

**The problem:** No single data provider has everything. Apollo might have the email, but Clearbit has the company details, and Hunter has the phone number.

**What Morket does:** Morket connects to multiple data providers â€” **Apollo, Clearbit, Hunter, and LinkedIn** â€” and queries them in a smart order. If one provider doesn't have the data, Morket automatically tries the next one. You get the most complete picture possible without managing multiple subscriptions yourself.

**What it means for you:** Higher match rates, more complete data, and less wasted budget on empty lookups.

---

### âš™ï¸ Workflow Automation â€” Set It and Forget It

**The problem:** Your enrichment process has multiple steps: import data, enrich emails, enrich phone numbers, score quality, push to CRM. Doing this manually every week is a chore.

**What Morket does:** Build visual workflows that chain these steps together. Set a schedule (daily, weekly, whatever you need) and Morket runs the whole pipeline automatically. If something fails, it retries. If a provider goes down, it switches to a backup.

**Example:** *Every Monday at 8 AM, Morket automatically imports new leads from your marketing form, enriches them with email and phone data, scores their quality, and pushes the top-scoring leads directly into your Salesforce pipeline. You arrive at work with fresh leads waiting.*

---

### ðŸ¤ CRM Integrations â€” Salesforce & HubSpot, Connected

**The problem:** Enriched data is useless if it's stuck in a separate tool. Your sales team lives in Salesforce or HubSpot.

**What Morket does:** Connect your CRM with a few clicks using secure OAuth. Map your Morket fields to your CRM fields, then push enriched records directly â€” or pull existing CRM data into Morket for enrichment. Sync history keeps track of everything.

**Supported CRMs:** Salesforce and HubSpot (with more coming)

---

### ðŸ‘¥ Team Collaboration â€” Work Together, Stay in Control

**The problem:** Multiple people need access to the same data, but you need to control who can do what.

**What Morket does:** Create shared workspaces where your whole team can collaborate. Assign roles to control access:

| Role | What They Can Do |
|------|-----------------|
| ðŸ‘€ **Viewer** | See data, export CSVs |
| ðŸ‘¤ **Member** | Edit records, run enrichments, import data |
| ðŸ›¡ï¸ **Admin** | Manage credentials, members, and workspace settings |
| ðŸ‘‘ **Owner** | Full control, including billing and deletion |
| ðŸ’° **Billing Admin** | Manage subscriptions and payments only |

Plus: activity feeds so you can see who did what, an immutable audit log for compliance, and email invitations with one-click accept.

---

### ðŸ“ˆ Analytics Dashboard â€” Know What's Working

**The problem:** You're spending money on data enrichment, but you have no idea which providers are delivering results or how your credits are being used.

**What Morket does:** A visual dashboard with three tabs:

- **Enrichment tab** â€” Success rates by provider, so you know which ones are worth the spend
- **Scraping tab** â€” How your web scraping jobs are performing
- **Credits tab** â€” Where your budget is going, with usage trends over time

Filter by time range (last 24 hours, 7 days, 30 days, 90 days, or custom) and export reports to CSV.

---

### ðŸ”Ž Instant Search â€” Find Anything, Fast

**The problem:** You have tens of thousands of records. Finding a specific company or contact shouldn't require scrolling through pages.

**What Morket does:** Type a few letters and Morket instantly suggests matching records. Full-text search across all your data with fuzzy matching (so typos don't stop you), faceted filtering (narrow by company, title, location), and results ranked by relevance.

---

### ðŸ§  AI Intelligence â€” Smarter Data, Less Effort

**The problem:** Messy data, duplicate records, and inconsistent formatting waste your team's time.

**What Morket does:**
- **Quality Scoring** â€” Every record gets a confidence score so you know which leads are solid and which need more work
- **Smart Field Mapping** â€” When you import a CSV, Morket auto-detects which columns map to which fields (even if the headers are slightly different)
- **Duplicate Detection** â€” Fuzzy matching finds near-duplicates that exact matching would miss ("John Smith" vs "Jon Smith")
- **Natural Language Queries** â€” Ask questions in plain English like "show me all marketing directors in New York" and Morket translates it into filters

---

### ðŸ”’ Enterprise Security â€” Your Data Is Safe

**The problem:** You're handling sensitive contact data. A breach would be catastrophic.

**What Morket does:** Six layers of security protection:

1. **Encryption everywhere** â€” All credentials and sensitive data encrypted with AES-256-GCM (the same standard banks use)
2. **Access controls** â€” Role-based permissions, account lockout after failed logins, and token-based authentication
3. **API protection** â€” Rate limiting, input validation, and SSRF prevention
4. **Audit trail** â€” Every action is logged. You always know who did what and when
5. **Infrastructure hardening** â€” HTTPS everywhere, container security, VPC isolation
6. **Supply chain security** â€” All dependencies pinned and scanned for vulnerabilities

---

### ðŸ’³ Pay-As-You-Go Billing â€” No Surprises

**The problem:** Flat-rate data tools charge you whether you use them or not. Some months you need 10,000 lookups, other months you need 500.

**What Morket does:** Credit-based pricing. Buy credits, use them when you need them. Failed lookups don't cost you anything â€” credits are only consumed on successful enrichments.

**Plans available:** Free (to try it out), Starter, Pro, and Enterprise. Purchase additional credit packs anytime through Stripe.

---

## ðŸ›¤ï¸ How It Works â€” 5 Simple Steps

1. **Sign up** and create a workspace for your team
2. **Add your data** â€” paste it in, import a CSV, or pull from your CRM
3. **Connect your providers** â€” add API keys for Apollo, Clearbit, Hunter, or use built-in web scraping
4. **Hit "Enrich"** â€” Morket fills in the missing data automatically, trying multiple sources
5. **Use your data** â€” export to CSV, push to Salesforce/HubSpot, or build automated workflows

That's it. No coding required. No complex setup. Just better data, faster.

---

## ðŸŽ¯ Who Is Morket For?

| Role | How Morket Helps |
|------|-----------------|
| **Sales Development Reps (SDRs)** | Stop spending 2 hours a day on manual research. Get enriched lead lists in minutes. |
| **Marketing Directors** | Build targeted campaign lists with verified contact data. Know exactly who you're reaching. |
| **Revenue Operations** | Automate your data pipeline from lead capture to CRM. Eliminate manual data entry. |
| **Sales Managers** | Give your team clean, complete data so they can focus on selling, not searching. |
| **Founders & CEOs** | Scale your outbound without scaling your headcount. One tool replaces a stack of subscriptions. |
| **Investors** | Morket is a modern, full-stack GTM data platform built to production standards with enterprise-grade security. |

---

## âš¡ What Makes Morket Different?

| | Manual Process | Single-Provider Tool | **Morket** |
|---|---|---|---|
| **Time to enrich 5,000 leads** | 2â€“3 weeks | 1â€“2 days | **Minutes** |
| **Data completeness** | Depends on who's Googling | Limited to one source | **Multiple providers, automatic fallback** |
| **Cost control** | Salary + tool subscriptions | Flat monthly fee (use it or lose it) | **Pay only for successful lookups** |
| **CRM sync** | Copy-paste or CSV upload | Maybe, with extra setup | **Built-in Salesforce & HubSpot sync** |
| **Duplicate handling** | "I think we already have this one..." | Basic exact matching | **AI-powered fuzzy matching** |
| **Team collaboration** | Shared Google Sheets ðŸ˜¬ | Per-seat licensing | **Shared workspaces with role-based access** |
| **Automation** | Reminders on your calendar | Limited triggers | **Visual workflow builder with scheduling** |
| **Security** | Hope for the best | Varies | **6-layer defense-in-depth, AES-256 encryption** |

---

## â“ Frequently Asked Questions

**Do I need to be technical to use Morket?**
Not at all. If you can use a spreadsheet, you can use Morket. The interface is designed to feel familiar from day one.

**What data providers does Morket support?**
Apollo, Clearbit, Hunter, and LinkedIn (via web scraping). More providers are on the roadmap. You bring your own API keys â€” Morket orchestrates the lookups.

**How does pricing work?**
Morket uses a credit system. Each successful data lookup costs a certain number of credits depending on the provider. Failed lookups are free. You can buy credit packs anytime, and there are subscription tiers (Free, Starter, Pro, Enterprise) that include monthly credit allowances.

**Is my data secure?**
Yes. Morket uses AES-256-GCM encryption (the same standard used by banks and governments), role-based access controls, audit logging, and six layers of security hardening. See the Technical Documentation section below for the full security breakdown.

**Can I try it for free?**
Yes â€” the Free plan lets you explore the platform and run a limited number of enrichments to see if it's right for your team.

**Does it integrate with my CRM?**
Morket integrates with Salesforce and HubSpot out of the box. Connect via OAuth (no API keys to manage), map your fields, and push/pull records with a click.

**How is this different from Clay.com?**
Morket is an open-source, self-hostable alternative. You own your data, control your infrastructure, and aren't locked into a SaaS vendor. Plus, the multi-provider waterfall enrichment and built-in web scraping give you more flexibility.

**Can my whole team use it?**
Absolutely. Create a workspace, invite your team via email, and assign roles (Viewer, Member, Admin, Owner). Everyone works from the same data with appropriate access controls.

---
---

## ðŸ”§ Technical Documentation

> Everything below is for developers, DevOps engineers, and technical evaluators. It covers architecture, API endpoints, tech stack, security internals, project structure, setup instructions, testing, and the development roadmap.

---

## ðŸ›¡ï¸ Security

Morket implements defense-in-depth security across 6 layers:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 6: Supply Chain                                          â”‚
â”‚  Pinned deps Â· npm/pip audit Â· Trivy Â· Gitleaks Â· SHA-pinned CIâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Layer 5: Observability & Audit                                 â”‚
â”‚  Header/field redaction Â· Security event logging Â· Trace IDs   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Layer 4: Data Protection                                       â”‚
â”‚  AES-256-GCM Â· HKDF Â· XSS encoding Â· SSRF prevention Â· CSV    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Layer 3: Authentication & Authorization                        â”‚
â”‚  JWT (iss/aud/jti) Â· Lockout Â· Replay detection Â· RBAC Â· 5 rolesâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Layer 2: API Gateway                                           â”‚
â”‚  Rate limiting Â· Security headers Â· CORS allowlist Â· Body limitsâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Layer 1: Edge & Infrastructure                                 â”‚
â”‚  HTTPS/HSTS Â· CSP Â· Pinned images Â· Read-only FS Â· VPC Â· KMS  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Layer 1: Edge & Infrastructure

- HTTPS everywhere with HSTS (1-year max-age, includeSubDomains)
- Content Security Policy preventing XSS and clickjacking
- Pinned Docker base images with provenance labels
- Read-only container filesystems with dropped Linux capabilities (`no-new-privileges`)
- VPC flow logs, restricted security groups (ports 3000/8001/7233 only)
- Encryption at rest for Aurora, Redis, OpenSearch, RabbitMQ, and S3
- Encryption in transit via TLS/SSL on all inter-service communication
- Automatic secret rotation on a 90-day interval via AWS Secrets Manager

### Layer 2: API Gateway

- Route-specific rate limiting â€” auth: 5/min, enrichment: 20/min, admin: 10/min, general: 100/min â€” with `Retry-After` headers on 429 responses
- Security headers: HSTS, `X-Content-Type-Options: nosniff`, `X-Frame-Options: DENY`, `Permissions-Policy` (camera/microphone/geolocation disabled), `X-Powered-By` removed
- CORS with explicit origin allowlist (no wildcards)
- Request body limits: 1MB JSON, 10MB file uploads
- Production error sanitization â€” stack traces, file paths, and raw database errors are stripped from all client-facing responses

### Layer 3: Authentication & Authorization

- JWT tokens with `iss`/`aud` validation, unique token IDs (`jti`), and Redis-based revocation list
- Account lockout after 5 failed login attempts within a 15-minute window
- Generic error messages on login failure â€” prevents user enumeration for both non-existent emails and wrong passwords
- Refresh token replay detection â€” if a previously used token is presented, all tokens for that user are immediately revoked
- Maximum 10 active refresh tokens per user with FIFO eviction of oldest tokens
- Token expiry enforced at the config level via Zod schemas (max 15min access, max 7d refresh)
- RBAC with workspace ID cross-check on URL parameters, object-level ownership middleware, and billing_admin isolation
- 5 role tiers: `owner` > `admin` > `member` > `viewer` + `billing_admin`

### Layer 4: Data Protection

- AES-256-GCM encryption with HKDF per-workspace key derivation
- Master key validation (exactly 32 bytes) with workspace ID hash as HKDF salt
- Write-verify pattern: every encrypted value is decrypted immediately after write to confirm integrity
- HTML entity encoding on all rendered content (XSS prevention)
- CSV formula injection detection â€” blocks cells starting with `=`, `+`, `-`, `@`
- SSRF prevention via DNS resolution and private IP range rejection (RFC 1918, loopback, link-local)
- AI-generated filter validation against a field name whitelist and operator set

### Layer 5: Observability & Audit

- Sensitive header redaction: `Authorization`, `X-Service-Key` â†’ `[REDACTED]`
- Sensitive field redaction: `password`, `secret`, `token`, `apiKey` â†’ `[REDACTED]`
- Security event logging with OpenTelemetry `trace_id`/`span_id` correlation
- Dedicated logging functions: `logAuthFailure`, `logAuthzFailure`, `logRateLimitHit`, `logWebhookFailure`
- Credential CRUD audit trail â€” logs user ID, workspace ID, and credential ID, never the credential value
- Webhook HMAC includes timestamp in the signed payload for replay prevention (5-minute window)

### Layer 6: Supply Chain

- All npm and pip dependencies pinned to exact versions â€” no `^`, `~`, or `>=` ranges
- `npm audit` + `pip-audit` run in CI on every build
- Trivy container image scanning for CRITICAL and HIGH CVEs
- Gitleaks secret scanning on every PR and deploy
- GitHub Actions pinned to commit SHAs (not mutable version tags)
- Docker build context verified clean of `.env` files and secret patterns

### Formal Verification

26 security correctness properties are defined as formal specifications and validated through property-based testing with 100+ iterations per property:

| Layer | Framework | Properties | Coverage |
|-------|-----------|------------|----------|
| Backend | fast-check | 15 | Auth, RBAC, rate limiting, encryption, sanitization, logging, webhooks |
| Frontend | fast-check | 2 | Deep link validation, content sanitization |
| Scraper | hypothesis | 9 | URL validation, key comparison, credential handling, webhook signing |

These properties are not example-based tests â€” they generate randomized inputs across the entire input space to verify that security invariants hold universally.

## Why Morket?

This isn't a CRUD app with a login page. Morket is a full-stack data platform built to production standards:

- **14 self-contained backend modules** following clean architecture (Routes â†’ Controllers â†’ Services â†’ Repositories)
- **Dual-database architecture** â€” PostgreSQL for OLTP, ClickHouse (ReplacingMergeTree) for OLAP, with CDC replication
- **Temporal.io** for durable, fault-tolerant enrichment workflows with idempotency keys and cancellation signals
- **Headless browser scraping** with anti-detection (fingerprint randomization, webdriver masking), proxy rotation, and per-domain rate limiting
- **AG Grid spreadsheet** handling 100k+ rows with DOM virtualization, undo stack, auto-save, and Web Worker CSV processing
- **68 correctness properties** validated by property-based tests (33 enrichment/core + 26 security + 9 menu-fixes/options) across three frameworks
- **Full AWS infrastructure as code** â€” 13 Terraform modules, GitHub Actions CI/CD with path-filtered builds and production approval gates
- **Defense-in-depth security** across 6 layers, from HSTS and CSP at the edge to pinned dependencies and container scanning in the supply chain

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Client / SDK                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ HTTP
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   API Gateway (Express.js)               â”‚
â”‚  Rate Limiter â†’ Request ID â†’ Tracing â†’ Logger â†’ Helmet/CORS  â”‚
â”‚  â†’ Auth (JWT) â†’ RBAC â†’ Zod Validation â†’ Router          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â–¼          â–¼                         â–¼          â–¼
Auth      Workspace              Credential   Credit/Billing
Module     Module                 Module       Module
   â”‚          â”‚                         â”‚          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   Enrichment Module     â”‚
              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
              â”‚  â”‚ Provider Registry â”‚  â”‚
              â”‚  â”‚ Circuit Breaker   â”‚  â”‚
              â”‚  â”‚ Webhook Service   â”‚  â”‚
              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚    Temporal.io Worker    â”‚
              â”‚  Workflows + Activities  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼                â–¼                â–¼                  â–¼
     Apollo API      Clearbit API     Hunter API     Scraper Service
                                                    (Python/FastAPI)
                                                          â”‚
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â–¼           â–¼           â–¼
                                        Browser Pool  Proxy Mgr  Extractors
                                        (Playwright)  (Rotation)  (Pluggable)
                                              â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â–¼         â–¼         â–¼
                                LinkedIn  Company    Job Board
                                Profiles  Websites   Postings
```

The backend follows a layered architecture: **Routes â†’ Controllers â†’ Services â†’ Repositories**, with each domain (auth, workspace, credential, credit, enrichment, billing, integration, data-ops, workflow, ai, team, analytics, search, replication) as a self-contained module.

## Tech Stack

| Layer | Technology |
|-------|-----------|
| Backend | Node.js, TypeScript (strict), Express.js |
| Database (OLTP) | PostgreSQL (Aurora-compatible) |
| Database (OLAP) | ClickHouse (ReplacingMergeTree) |
| Search | OpenSearch/ElasticSearch |
| Cache | Redis (ioredis) with graceful degradation |
| Workflow Engine | Temporal.io (durable enrichment workflows) |
| Billing | Stripe (subscriptions, credit packs, webhooks) |
| Auth | JWT (15min access / 7d refresh) with bcrypt (12 rounds) |
| Encryption | AES-256-GCM with HKDF per-workspace key derivation |
| Validation | Zod (backend + frontend), Pydantic (scraper) |
| Testing | Vitest + fast-check (TypeScript), pytest + hypothesis (Python) |
| Distributed Tracing | OpenTelemetry (HTTP, Express, PostgreSQL, Redis auto-instrumentation) |
| Scraping | Python 3.11+, FastAPI, Playwright (headless Chromium) |
| Frontend | React 18+, Zustand 5, AG Grid v32, Recharts, Tailwind CSS |
| Infrastructure | Docker, Terraform (13 modules), GitHub Actions, AWS (ECS Fargate, Aurora, ElastiCache, OpenSearch, S3, CloudFront) |

## Current Status: Complete âœ…

All 8 modules are complete, plus a comprehensive security audit and menu fixes with Options configuration. Application code (Modules 1â€“6) covers the full backend API, enrichment orchestration, scraping microservices, spreadsheet UI, OLAP analytics, and search layer. Module 7 provides Docker containerization, Terraform IaC for AWS, and GitHub Actions CI/CD. Module 8 adds Stripe billing, CRM integrations, advanced data operations, workflow builder, AI/ML intelligence, team collaboration, Redis caching, and observability. The security audit hardens all layers with 26 property-based correctness tests. The menu-fixes-options-config spec adds robust error/loading states across settings pages, a members list endpoint, and a full Options/service configuration page with encrypted storage, connection testing, and credential sync (9 additional property tests).

### What's built

#### Module 1: Core Backend Foundation
- **JWT Authentication** â€” Register, login, refresh token rotation, logout. Bcrypt (12 rounds), rate-limited auth endpoints (5/min per IP).
- **RBAC Middleware** â€” Role hierarchy (owner > admin > member > viewer), workspace-scoped permissions enforced at the middleware level.
- **Workspace Management** â€” CRUD with slug generation, member management (add/remove/update role), last-owner protection.
- **Encrypted Credential Storage** â€” AES-256-GCM with HKDF per-workspace key derivation. API responses only expose masked keys (last 4 chars).
- **Credit/Billing System** â€” Consumption-based credits with `SELECT FOR UPDATE` concurrency control, auto-recharge, immutable transaction ledger, paginated history.
- **API Infrastructure** â€” Consistent JSON envelope responses, X-Request-Id tracing, structured JSON logging, Helmet security headers, CORS, sliding-window rate limiting.

#### Module 2: Enrichment Orchestration
- **Provider Registry** â€” In-memory registry with Apollo, Clearbit, and Hunter providers. Each provider has Zod input/output schemas, credit costs, and supported fields.
- **Provider Adapters** â€” Pluggable adapter interface (`ProviderAdapter`) with HTTP calls, 30s timeouts, and error mapping.
- **Circuit Breaker** â€” Sliding window (10 calls, 5 failure threshold, 60s cooldown) per provider to protect against cascading failures.
- **Enrichment Jobs** â€” Create, list, get, and cancel enrichment jobs. Input validation, credit estimation, balance checking, and batch splitting (1000 records max).
- **Temporal.io Workflows** â€” Durable enrichment workflows with waterfall provider logic, idempotency keys, cancellation signals, and automatic status tracking.
- **Webhook Delivery** â€” HMAC-SHA256 signed webhooks with 10s timeout and 3 retries with exponential backoff (5s, 10s, 20s).
- **Database Migrations** â€” 11 sequential migration files covering all tables and indexes.
- **33 Correctness Properties** â€” Property-based tests using fast-check validating circuit breaker, waterfall, idempotency, and credit invariants.

### API Endpoints

```
# Auth (public, 5/min rate limit)
POST   /api/v1/auth/register
POST   /api/v1/auth/login
POST   /api/v1/auth/refresh
POST   /api/v1/auth/logout

# Workspaces (authenticated)
POST   /api/v1/workspaces
GET    /api/v1/workspaces
GET    /api/v1/workspaces/:id                    # member+
PUT    /api/v1/workspaces/:id                    # admin+
DELETE /api/v1/workspaces/:id                    # owner
POST   /api/v1/workspaces/:id/members            # admin+
DELETE /api/v1/workspaces/:id/members/:userId     # admin+
PUT    /api/v1/workspaces/:id/members/:userId/role # admin+
GET    /api/v1/workspaces/:id/members            # member+ (list members)

# Options / Service Configuration (authenticated)
GET    /api/v1/workspaces/:id/options              # admin+ (list all service configs)
PUT    /api/v1/workspaces/:id/options              # admin+ (upsert service config)
DELETE /api/v1/workspaces/:id/options              # admin+ (delete service config)
POST   /api/v1/workspaces/:id/options/:serviceKey/test  # admin+ (test connection)

# Credentials (authenticated)
POST   /api/v1/workspaces/:id/credentials         # admin+
GET    /api/v1/workspaces/:id/credentials         # member+
DELETE /api/v1/workspaces/:id/credentials/:credId  # admin+

# Billing (authenticated)
GET    /api/v1/workspaces/:id/billing              # member+
POST   /api/v1/workspaces/:id/billing/credits      # owner
GET    /api/v1/workspaces/:id/billing/transactions  # member+

# Providers (authenticated)
GET    /api/v1/providers                           # list all providers
GET    /api/v1/providers/:providerSlug             # provider details

# Enrichment Jobs (authenticated)
POST   /api/v1/workspaces/:id/enrichment-jobs              # member+
GET    /api/v1/workspaces/:id/enrichment-jobs              # member+
GET    /api/v1/workspaces/:id/enrichment-jobs/:jobId       # member+
POST   /api/v1/workspaces/:id/enrichment-jobs/:jobId/cancel # member+
GET    /api/v1/workspaces/:id/enrichment-jobs/:jobId/records # member+

# Enrichment Records (authenticated)
GET    /api/v1/workspaces/:id/enrichment-records/:recordId  # member+

# Webhooks (authenticated)
POST   /api/v1/workspaces/:id/webhooks             # admin+
GET    /api/v1/workspaces/:id/webhooks             # member+
DELETE /api/v1/workspaces/:id/webhooks/:webhookId   # admin+

# Analytics (authenticated, workspace-scoped)
GET    /api/v1/workspaces/:id/analytics/enrichment   # enrichment success rates
GET    /api/v1/workspaces/:id/analytics/credits       # credit usage analytics
GET    /api/v1/workspaces/:id/analytics/export        # CSV export

# Search (authenticated, workspace-scoped)
POST   /api/v1/workspaces/:id/search                  # full-text search
GET    /api/v1/workspaces/:id/search/suggest           # typeahead/autocomplete

# Search Admin (authenticated, admin only)
POST   /api/v1/admin/search/reindex                    # trigger reindex
GET    /api/v1/admin/search/status                     # index status

# Admin DLQ (authenticated, admin only)
GET    /api/v1/admin/analytics/dlq                     # dead letter queue entries
POST   /api/v1/admin/analytics/dlq/:id/retry           # retry failed event

# Health
GET    /api/v1/health
GET    /api/v1/readiness
GET    /api/v1/metrics

# Billing (Stripe)
GET    /api/v1/billing/plans                                    # public plan listing
POST   /api/v1/billing/webhooks                                 # Stripe webhook (raw body)
POST   /api/v1/workspaces/:id/billing/checkout                  # create Stripe Checkout session
POST   /api/v1/workspaces/:id/billing/portal                    # create Stripe Customer Portal
POST   /api/v1/workspaces/:id/billing/credits/purchase           # purchase credit pack
GET    /api/v1/workspaces/:id/billing/invoices                   # list invoices

# CRM Integrations
GET    /api/v1/integrations                                      # list available integrations
GET    /api/v1/integrations/callback                             # OAuth callback
POST   /api/v1/workspaces/:id/integrations/:provider/connect     # start OAuth flow
POST   /api/v1/workspaces/:id/integrations/:provider/disconnect  # disconnect
GET    /api/v1/workspaces/:id/integrations/:provider/field-mappings
PUT    /api/v1/workspaces/:id/integrations/:provider/field-mappings
POST   /api/v1/workspaces/:id/integrations/:provider/push        # push records to CRM
POST   /api/v1/workspaces/:id/integrations/:provider/pull        # pull records from CRM
GET    /api/v1/workspaces/:id/integrations/:provider/sync-history

# Data Operations
POST   /api/v1/workspaces/:id/data-ops/import/preview            # CSV preview
POST   /api/v1/workspaces/:id/data-ops/import/commit             # commit import
POST   /api/v1/workspaces/:id/data-ops/export                    # export CSV/JSON
POST   /api/v1/workspaces/:id/data-ops/dedup/scan                # find duplicates
POST   /api/v1/workspaces/:id/data-ops/dedup/merge               # merge duplicates
GET    /api/v1/workspaces/:id/data-ops/hygiene                   # data hygiene stats
POST   /api/v1/workspaces/:id/data-ops/bulk-delete               # bulk delete records
GET    /api/v1/workspaces/:id/data-ops/views                     # saved views CRUD
POST   /api/v1/workspaces/:id/data-ops/views
PUT    /api/v1/workspaces/:id/data-ops/views/:viewId
DELETE /api/v1/workspaces/:id/data-ops/views/:viewId
GET    /api/v1/workspaces/:id/data-ops/activity                  # record activity log

# Workflow Builder
POST   /api/v1/workspaces/:id/workflows                          # create workflow
GET    /api/v1/workspaces/:id/workflows                          # list workflows
GET    /api/v1/workspaces/:id/workflows/:workflowId              # get workflow
PUT    /api/v1/workspaces/:id/workflows/:workflowId              # update workflow
DELETE /api/v1/workspaces/:id/workflows/:workflowId              # delete workflow
GET    /api/v1/workspaces/:id/workflows/:workflowId/versions     # list versions
POST   /api/v1/workspaces/:id/workflows/:workflowId/rollback     # rollback to version
POST   /api/v1/workspaces/:id/workflows/:workflowId/execute      # execute workflow
GET    /api/v1/workspaces/:id/workflows/:workflowId/runs         # list runs
GET    /api/v1/workspaces/:id/workflows/templates                 # list templates
POST   /api/v1/workspaces/:id/workflows/templates/:templateId/clone
PUT    /api/v1/workspaces/:id/workflows/:workflowId/schedule     # set cron schedule

# AI/ML Intelligence
POST   /api/v1/workspaces/:id/ai/quality-score                   # score records
POST   /api/v1/workspaces/:id/ai/field-map                       # auto field mapping
POST   /api/v1/workspaces/:id/ai/dedup-detect                    # fuzzy duplicate detection
POST   /api/v1/workspaces/:id/ai/query                           # natural language query

# Team & Collaboration
GET    /api/v1/workspaces/:id/team/activity                      # activity feed
POST   /api/v1/workspaces/:id/team/activity                      # log activity
GET    /api/v1/workspaces/:id/team/audit-log                     # audit log
GET    /api/v1/workspaces/:id/team/audit-log/export              # export audit CSV
POST   /api/v1/workspaces/:id/team/invitations                   # invite by email
GET    /api/v1/workspaces/:id/team/invitations                   # list invitations
DELETE /api/v1/workspaces/:id/team/invitations/:invitationId     # revoke invitation
POST   /api/v1/invitations/:token/accept                         # accept (public)
POST   /api/v1/invitations/:token/decline                        # decline (public)
```

### Scraper Service Endpoints (packages/scraper â€” Module 3)

```
# Scrape Tasks (service-to-service, X-Service-Key auth)
POST   /api/v1/scrape                          # async scrape task
POST   /api/v1/scrape/sync                     # sync scrape (60s timeout)
GET    /api/v1/scrape/:taskId                   # task status + result

# Scrape Jobs (batch)
POST   /api/v1/scrape/batch                    # batch up to 100 targets
GET    /api/v1/scrape/jobs/:jobId              # job status + progress
GET    /api/v1/scrape/jobs/:jobId/results      # completed task results
POST   /api/v1/scrape/jobs/:jobId/cancel       # cancel queued tasks

# Health & Observability
GET    /health                                  # service + pool + proxy status
GET    /readiness                               # browser pool + proxy readiness
GET    /metrics                                 # queue depth, active workers, task stats
```

All responses follow the envelope format:
```json
{
  "success": true,
  "data": { ... },
  "error": null,
  "meta": { "page": 1, "limit": 20, "total": 42 }
}
```

## Getting Started

### Prerequisites

- Node.js 18+
- PostgreSQL 15+
- Redis 7+ (optional â€” backend degrades gracefully without it)
- Temporal.io server (for enrichment workflows)
- Python 3.11+ (for scraper service)
- Playwright (installed via `playwright install chromium`)

### Setup

```bash
# Clone
git clone https://github.com/ArcaneAIAutomation/Morket.git
cd Morket

# Install dependencies
cd packages/backend
npm install

# Configure environment
cp .env.example .env
# Edit .env with your database URL, JWT secret, etc.

# Run migrations
npm run migrate

# Start development server
npm run dev

# Run tests
npm test
```

### Environment Variables

```env
PORT=3000
NODE_ENV=development
DATABASE_URL=postgresql://user:password@localhost:5432/morket
JWT_SECRET=your-jwt-secret-min-32-chars-long
JWT_ACCESS_EXPIRY=15m
JWT_REFRESH_EXPIRY=7d
ENCRYPTION_MASTER_KEY=<64 hex chars>
CORS_ORIGIN=http://localhost:5173
REDIS_URL=redis://localhost:6379
LOG_LEVEL=info
CLICKHOUSE_URL=http://localhost:8123
OPENSEARCH_NODE=http://localhost:9200
STRIPE_SECRET_KEY=sk_test_...
STRIPE_WEBHOOK_SECRET=whsec_...
OTEL_ENABLED=true
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318/v1/traces
```

## Project Structure

```
packages/
â”œâ”€â”€ backend/                           # Express.js API (Modules 1â€“2, 5â€“6, 8)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ cache/                     # Redis client + generic cache layer
â”‚   â”‚   â”œâ”€â”€ clickhouse/                # ClickHouse client + health check
â”‚   â”‚   â”œâ”€â”€ config/env.ts              # Zod-validated env config
â”‚   â”‚   â”œâ”€â”€ middleware/                 # Auth, RBAC, validation, rate limiting, logging, errors, tracing
â”‚   â”‚   â”œâ”€â”€ observability/             # Structured JSON logger + in-memory metrics + OpenTelemetry tracing
â”‚   â”‚   â”œâ”€â”€ modules/
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/                  # User registration, login, JWT, refresh tokens
â”‚   â”‚   â”‚   â”œâ”€â”€ workspace/             # Workspace CRUD, membership management
â”‚   â”‚   â”‚   â”œâ”€â”€ credential/            # Encrypted API credential storage
â”‚   â”‚   â”‚   â”œâ”€â”€ credit/                # Credits, transaction ledger
â”‚   â”‚   â”‚   â”œâ”€â”€ enrichment/            # Enrichment orchestration (adapters, temporal, circuit breaker)
â”‚   â”‚   â”‚   â”œâ”€â”€ billing/               # Stripe subscriptions, credit purchases, webhooks
â”‚   â”‚   â”‚   â”œâ”€â”€ integration/           # CRM integrations (Salesforce, HubSpot) with OAuth2
â”‚   â”‚   â”‚   â”œâ”€â”€ data-ops/             # CSV import/export, dedup, hygiene, saved views, activity log
â”‚   â”‚   â”‚   â”œâ”€â”€ workflow/             # Workflow builder (CRUD, versioning, execution, templates, cron)
â”‚   â”‚   â”‚   â”œâ”€â”€ ai/                   # Quality scoring, field mapping, dedup detection, NL query
â”‚   â”‚   â”‚   â”œâ”€â”€ team/                 # Activity feed, audit log, workspace invitations
â”‚   â”‚   â”‚   â”œâ”€â”€ analytics/            # ClickHouse analytics queries + CSV export
â”‚   â”‚   â”‚   â”œâ”€â”€ search/               # OpenSearch full-text search + admin reindex
â”‚   â”‚   â”‚   â””â”€â”€ replication/          # CDC pipeline + dead letter queue
â”‚   â”‚   â”œâ”€â”€ shared/                    # DB pool, encryption, errors, envelope, types
â”‚   â”‚   â”œâ”€â”€ app.ts                     # Express app assembly
â”‚   â”‚   â””â”€â”€ index.ts                   # Entry point
â”‚   â”œâ”€â”€ migrations/                    # 23 sequential PostgreSQL migrations + ClickHouse migrations
â”‚   â””â”€â”€ tests/
â”‚       â”œâ”€â”€ integration/               # End-to-end HTTP flow tests
â”‚       â””â”€â”€ property/                  # fast-check property-based tests
â”‚
â”œâ”€â”€ scraper/                           # Python scraping service (Module 3)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ config/                    # Pydantic Settings, domain policies (YAML)
â”‚   â”‚   â”œâ”€â”€ routers/                   # FastAPI route handlers
â”‚   â”‚   â”œâ”€â”€ services/                  # Task queue, job orchestration
â”‚   â”‚   â”œâ”€â”€ browser/                   # Browser pool, fingerprint randomizer
â”‚   â”‚   â”œâ”€â”€ extractors/                # Pluggable page extractors (linkedin, company, job)
â”‚   â”‚   â”œâ”€â”€ proxy/                     # Proxy manager, rotation, health checks
â”‚   â”‚   â”œâ”€â”€ resilience/                # Circuit breaker, domain rate limiter
â”‚   â”‚   â”œâ”€â”€ integration/               # Credential client, webhook callbacks
â”‚   â”‚   â”œâ”€â”€ models/                    # Pydantic request/response models, normalizers
â”‚   â”‚   â””â”€â”€ main.py                    # FastAPI app entry point
â”‚   â”œâ”€â”€ tests/                         # pytest + hypothesis tests
â”‚   â””â”€â”€ pyproject.toml                 # Python project config (Black, Ruff, pytest)
â”‚
â”œâ”€â”€ frontend/                          # React spreadsheet UI (Module 4)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ api/                       # Axios HTTP client + per-domain API modules (auth, workspace, records, enrichment, analytics, search, billing, credentials, members, options)
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ analytics/             # Dashboard with enrichment/scraping/credits tabs + Recharts
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/                  # LoginForm, RegisterForm
â”‚   â”‚   â”‚   â”œâ”€â”€ enrichment/            # EnrichmentPanel, WaterfallConfig
â”‚   â”‚   â”‚   â”œâ”€â”€ jobs/                  # JobMonitor, JobRow, JobRecordDetail
â”‚   â”‚   â”‚   â”œâ”€â”€ layout/               # AppShell, AuthGuard, Header, Sidebar
â”‚   â”‚   â”‚   â”œâ”€â”€ search/               # SearchBar, SearchResultsView, FacetSidebar, SearchPagination
â”‚   â”‚   â”‚   â”œâ”€â”€ settings/             # Workspace, Billing, Credential, Member, Options settings
â”‚   â”‚   â”‚   â”œâ”€â”€ shared/               # ErrorBoundary, Toast, ConfirmDialog, LoadingSpinner, OfflineBanner
â”‚   â”‚   â”‚   â””â”€â”€ spreadsheet/          # SpreadsheetView (AG Grid), GridToolbar, ContextMenu, CSVImportDialog, ColumnDialog, CellRenderer, StatusBar
â”‚   â”‚   â”œâ”€â”€ hooks/                     # useAuth, useAutoSave, useJobPolling, useRole, useSearch, useAnalytics, useOnlineStatus
â”‚   â”‚   â”œâ”€â”€ stores/                    # Zustand stores: auth, grid, workspace, job, analytics, search, ui
â”‚   â”‚   â”œâ”€â”€ types/                     # TypeScript interfaces (api, grid, enrichment, search, analytics)
â”‚   â”‚   â”œâ”€â”€ utils/                     # formatters, permissions (role-based action map)
â”‚   â”‚   â””â”€â”€ workers/                   # CSV Web Worker (parse + generate off main thread)
â”‚   â”œâ”€â”€ tests/
â”‚   â”‚   â””â”€â”€ property/                  # 11 fast-check property test suites
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ vite.config.ts                 # Vite 6 + React plugin + dev proxy + Vitest config
â”‚   â”œâ”€â”€ tailwind.config.js
â”‚   â””â”€â”€ tsconfig.json

docker/                                # Dockerfiles for backend, scraper, frontend + nginx config
terraform/                             # AWS IaC â€” 13 reusable modules
docker-compose.yml                     # Full local dev stack
```

## Testing

```bash
npm test              # Run all 400+ tests
npm run test:watch    # Watch mode
npm run test:coverage # With coverage report
```

The test suite spans three frameworks across three languages:

- **400+ unit and integration tests** covering schema validation, middleware behavior, service logic, adapter behavior, and full HTTP flows
- **68 property-based correctness properties** (33 enrichment/core + 26 security + 9 menu-fixes/options) â€” not example-based tests, but formal specifications that generate randomized inputs to verify invariants hold universally
- **100+ iterations per property = 6,800+ generated test cases** across the full input space
- **Three testing frameworks**: Vitest + fast-check (TypeScript backend/frontend), pytest + hypothesis (Python scraper)

Property coverage includes: auth, RBAC, encryption, rate limiting, circuit breaker, waterfall enrichment, idempotency, webhooks, input sanitization, SSRF prevention, deep link validation, credential handling, and audit logging.

## Roadmap

### âœ… Module 1: Core Backend Foundation
> *Status: Complete*

Express.js API gateway, PostgreSQL schema, JWT auth with refresh rotation, RBAC, workspace management, AES-256-GCM credential encryption, credit/billing system, 27 property-based correctness tests.

---

### âœ… Module 2: Enrichment Orchestration
> *Status: Complete*

Temporal.io workflow engine for orchestrating multi-step data enrichment pipelines. Each enrichment action consumes credits and calls external data providers using stored credentials.

- Temporal.io worker and workflow definitions
- Provider adapter registry (Apollo, Clearbit, Hunter) with pluggable interface
- Waterfall enrichment (try provider A, fall back to B) with idempotency keys
- Credit consumption per action with rollback on failure
- Circuit breaker (sliding window, 5 failure threshold, 60s cooldown)
- Webhook callbacks with HMAC-SHA256 signatures and retry logic
- Job status tracking, batch splitting (1000 records max), and cancellation
- 6 property-based correctness tests for waterfall, idempotency, circuit breaker, and credits

---

### âœ… Module 3: Scraping Microservices
> *Status: Complete*

Python/FastAPI/Playwright scraping service for data sources without APIs. Runs as a standalone microservice communicating with the backend via REST API. Acts as an enrichment provider callable by Temporal.io workflows.

- FastAPI service with Pydantic validation and OpenAPI docs
- Playwright headless Chromium browser pool (5â€“20 instances, auto-recycling)
- Pluggable page extractors: LinkedIn profiles, company websites, job postings
- Anti-detection: fingerprint randomization, webdriver masking, human-like delays
- Proxy rotation with health monitoring and per-domain cooldowns
- Per-domain rate limiting (token bucket) with YAML policy overrides and robots.txt compliance
- Circuit breaker per target domain (sliding window, 120s cooldown)
- Credential retrieval from backend with in-memory caching (5min TTL)
- Result normalization into Pydantic models matching enrichment pipeline schemas
- Async task queue with priority scheduling and concurrency control
- Batch processing (max 100 targets) with job lifecycle management
- HMAC-SHA256 signed webhook callbacks with retry logic
- Docker multi-stage build with resource limits (2 CPU, 4GB RAM)
- Structured JSON logging, /metrics and /health endpoints
- 15 requirements with 97 acceptance criteria

---

### âœ… Module 4: Spreadsheet UI
> *Status: Complete*

React-based spreadsheet interface using AG Grid for high-performance data manipulation. The primary user interface for viewing, editing, and enriching prospect data.

- React 18+ with TypeScript (strict), Vite 6 build tooling, Tailwind CSS styling
- Zustand 5 state management â€” 7 domain stores (auth, grid, workspace, job, analytics, search, ui)
- AG Grid v32 with DOM virtualization for 100k+ row datasets, custom alpine theme overrides
- Axios HTTP client with auto token refresh, envelope unwrapping, dual timeout instances (30s/120s)
- Spreadsheet: cell editing with undo stack (50-deep), auto-save (30s interval), context menus, column management (add/hide/reorder/resize/delete)
- CSV import/export via Web Worker for off-main-thread processing (â‰¥10k rows), with column mapping dialog and progress reporting
- Enrichment job polling (5s interval) with terminal status detection, toast notifications, and automatic grid cell updates
- Analytics dashboard: 3 tabs (enrichment/scraping/credits) with Recharts charts, time range filters (24h/7d/30d/90d/custom), parallel data fetching
- Full-text search: debounced typeahead (200ms), faceted sidebar, sort by relevance/date/name, pagination, highlighted matches
- Role-based UI permissions: viewer < member < admin < owner, toolbar buttons conditionally rendered via `useRole()` hook
- Offline detection with banner warning, auto-save skip when offline
- Lazy-loaded routes (AnalyticsDashboard, SearchResultsView) via React.lazy + Suspense
- Settings pages: workspace config, billing/credits, credential management (masked keys), member management, options/service configuration
- 11 property-based test suites (fast-check): api-envelope, csv-roundtrip, enrichment-cost, grid-operations, permissions, sort-filter, toast-behavior, error-extraction, billing-resilience, billing-independence, options-validation
- Unit tests with Testing Library + MSW for API mocking

---

### âœ… Module 5: OLAP Analytics Layer
> *Status: Complete*

ClickHouse integration for analytical queries across enrichment data. Separates read-heavy analytics from the OLTP PostgreSQL database.

- ClickHouse schema with ReplacingMergeTree for deduplication
- CDC pipeline from PostgreSQL â†’ ClickHouse
- Pre-aggregated materialized views for dashboards
- Enrichment success rate analytics
- Credit usage analytics and forecasting
- API endpoints for dashboard data

---

### âœ… Module 6: Search
> *Status: Complete*

OpenSearch/ElasticSearch integration for full-text search across enriched prospect data.

- OpenSearch index management and mapping
- Real-time indexing pipeline from PostgreSQL
- Full-text search with fuzzy matching and filters
- Faceted search (by company, title, location, etc.)
- Search result ranking and relevance tuning
- Typeahead/autocomplete API

---

### âœ… Module 7: Infrastructure & DevOps
> *Status: Complete*

Production-grade infrastructure on AWS with CI/CD automation.

- Docker multi-stage builds for all services (backend, scraper, frontend)
- Terraform IaC for AWS: 13 reusable modules (VPC, ECS, ALB, Aurora, ClickHouse, Redis, RabbitMQ, OpenSearch, S3, CloudFront, ECR, Secrets, Monitoring)
- Environment configs for staging (reduced) and production (full-scale, multi-AZ, auto-scaling)
- GitHub Actions CI pipeline: path-filtered jobs for backend, scraper, frontend, terraform
- GitHub Actions Deploy pipeline: ECR push, ECS rolling deploy, S3 + CloudFront for frontend, migration runner, production approval gate
- CloudWatch alarms, dashboard, SNS notifications
- docker-compose.yml for full local dev stack

### âœ… Module 8: Product Enhancements & Growth Features
> *Status: Complete*

Eight sub-modules covering billing, integrations, data operations, workflow builder, AI/ML, team collaboration, performance, and observability.

- **8.1 AI/ML Intelligence** â€” Data quality scoring (confidence %, freshness), smart field mapping with alias dictionary, fuzzy duplicate detection (Levenshtein), natural language query parser
- **8.2 Visual Workflow Builder** â€” Workflow CRUD with automatic versioning, graph definition (data_source/enrichment_step/filter/output nodes), version rollback, async execution with run tracking, template cloning, cron scheduling
- **8.3 CRM Integrations** â€” Salesforce & HubSpot OAuth2 flows, bi-directional field mapping, push/pull records, sync history, encrypted token storage per workspace
- **8.4 Stripe Billing** â€” Subscription management (free/starter/pro/enterprise), credit pack purchases, Stripe Checkout + Customer Portal, webhook handling, invoice listing
- **8.5 Advanced Data Operations** â€” CSV import (two-phase preview/commit), export (CSV/JSON), dedup scan + merge, data hygiene stats, bulk delete, saved views CRUD, record activity log
- **8.6 Team & Collaboration** â€” Extended roles (viewer, billing_admin), activity feed, immutable audit log with CSV export, workspace invitations with 7-day expiry tokens
- **8.7 Performance & Scale** â€” Redis caching layer (ioredis) with graceful degradation, domain-specific cache helpers (workspace config 5min, user session 15min, provider health 1min), Redis health check
- **8.8 Observability & Operations** â€” Structured JSON logger with configurable levels, in-memory request/error metrics, GET /api/v1/metrics and GET /api/v1/readiness endpoints, OpenTelemetry distributed tracing with auto-instrumentation (HTTP, Express, PostgreSQL, Redis), OTLP exporter, log-trace correlation (trace_id/span_id in log entries)

---

### âœ… Security Audit
> *Status: Complete*

Defense-in-depth security hardening across all 6 layers of the platform â€” infrastructure, API gateway, authentication, data protection, observability, and supply chain. 13 requirement areas with 26 formally specified correctness properties validated by property-based tests. See the [Security](#-security) section above for full details.

---

## License

Private â€” All rights reserved.
